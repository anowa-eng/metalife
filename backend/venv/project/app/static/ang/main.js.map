{"version":3,"file":"main.js","mappings":"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","sources":["./src/app/app-routing.module.ts","./src/app/app.component.ts","./src/app/app.component.html","./src/app/app.module.ts","./src/app/http.service.ts","./src/app/room-view/collision-point.ts","./src/app/room-view/room-data.service.ts","./src/app/room-view/room-view.component.ts","./src/app/room-view/room-view.component.html","./src/app/room-view/transform-data.ts","./src/app/room-view/web-socket.service.ts","./src/app/user-data.service.ts","./src/app/window.service.ts","./src/environments/environment.ts","./src/main.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nconst routes: Routes = [];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule { }\r\n","import { Component, OnInit, ViewChild, ElementRef, ComponentRef, AfterViewInit } from '@angular/core';\r\n\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent {\r\n}\r\n","<app-room-view></app-room-view>\r\n","import { NgModule } from '@angular/core';\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { RoomViewComponent } from './room-view/room-view.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppComponent,\r\n    RoomViewComponent\r\n  ],\r\n  imports: [\r\n    BrowserModule,\r\n    HttpClientModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n\r\n    AppRoutingModule\r\n  ],\r\n  exports: [\r\n    AppComponent,\r\n    RoomViewComponent\r\n  ],\r\n  providers: [],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule { }\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class HttpService {\r\n  httpClient: HttpClient;\r\n\r\n  constructor(httpClient: HttpClient) {\r\n    this.httpClient = httpClient;\r\n  }\r\n}\r\n","import { LocalUser } from \"./local-user\";\r\nimport { Position } from \"./position\";\r\n\r\nexport function findCollisionPoint(localUser: Position, collidedUser: Position) {\r\n    const circleRadius = 12.5;\r\n\r\n    let angle = Math.atan2(collidedUser.y - localUser.y, collidedUser.x - localUser.x);\r\n    console.log(angle * (180 / Math.PI))\r\n\r\n    let collisionPoint = {\r\n        x: collidedUser.x - Math.cos(angle) * circleRadius * 2,\r\n        y: collidedUser.y - Math.sin(angle) * circleRadius * 2\r\n    };\r\n\r\n    return collisionPoint;\r\n}","import { Injectable } from '@angular/core';\r\n\r\nimport { HttpService } from './../http.service';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RoomDataService {\r\n  constructor(private httpService: HttpService) {}\r\n\r\n  getInitialData(): Observable<any> {\r\n    return this.httpService.httpClient.get('/api/get-initial-room-data', { responseType: 'json' });\r\n  }\r\n\r\n  getCurrentRoomId(): Observable<any> {\r\n    return new Observable((subscriber) => {\r\n      this.httpService.httpClient.get('/api/current-room', { responseType: 'text' })\r\n        .subscribe((data) => {\r\n          let currentRoomId = parseInt(data);\r\n          subscriber.next(currentRoomId)\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { Component, ElementRef, EventEmitter, HostListener, OnInit, ViewChild } from '@angular/core';\r\n\r\nimport { RoomDataService } from './room-data.service';\r\nimport { UserDataService } from './../user-data.service';\r\n\r\nimport { transformData } from './transform-data';\r\nimport { WindowService } from '../window.service';\r\nimport { WebSocketService } from './web-socket.service';\r\n\r\nimport _ from 'lodash';\r\nimport { LocalUser } from './local-user';\r\n\r\nimport { Position } from './position';\r\nimport { UserPositionData } from './user-position-data';\r\nimport { Distances } from './distances';\r\nimport imageSize from '@coderosh/image-size';\r\nimport { findCollisionPoint } from './collision-point';\r\n\r\n@Component({\r\n  selector: 'app-room-view',\r\n  templateUrl: './room-view.component.html',\r\n  styleUrls: ['./room-view.component.scss']\r\n})\r\nexport class RoomViewComponent implements OnInit {\r\n  untransformedData!: any[];\r\n  data: UserPositionData[] = [];\r\n  userProfiles!: any[];\r\n\r\n  localUser: LocalUser = {\r\n    position: {\r\n      x: 0,\r\n      y: 0\r\n    },\r\n    direction: 0,\r\n    velocity: 0,\r\n    angularVelocity: 0,\r\n    drag: 0,\r\n    angularDrag: 0,\r\n    id: 1,\r\n\r\n    hist: {\r\n      prevPosition: null,\r\n      prevDirection: null\r\n    }\r\n  };\r\n\r\n  _permittedKeys = [\r\n    'ArrowLeft',\r\n    'ArrowRight',\r\n    'ArrowUp'\r\n  ];\r\n  _keysDown: string[] = [];\r\n\r\n  frames: Partial<UserPositionData>[] = [];\r\n\r\n  animationId!: number;\r\n  shouldContinueAnimating: boolean = true;\r\n\r\n  circleRadius = 12.5;\r\n\r\n  @ViewChild('roomView')\r\n  roomView?: ElementRef;\r\n\r\n  constructor(\r\n    private roomDataService: RoomDataService,\r\n    private userDataService: UserDataService,\r\n    private webSocketService: WebSocketService,\r\n    private windowService: WindowService,\r\n  ) {}\r\n\r\n  @HostListener('window:beforeunload')\r\n  onUnload() {\r\n    this.shouldContinueAnimating = false;\r\n  }\r\n\r\n  getDimensions() {\r\n    return this.windowService.getDimensions();\r\n  }\r\n\r\n  getCenterLocation() {\r\n    let dimensions = this.windowService.getDimensions();\r\n\r\n    let centerX = dimensions.width / 2;\r\n    let centerY = dimensions.height / 2;\r\n\r\n    return {\r\n      x: centerX,\r\n      y: centerY\r\n    };\r\n  }\r\n\r\n  async loadProfiles() {\r\n    if (this.data && this.data.length) {\r\n      let ids = this.data?.map((user) => user.user_id);\r\n      this.userDataService.loadUserProfiles(ids)\r\n        .subscribe((profiles) => {\r\n          this.userProfiles = profiles;\r\n        });\r\n    }\r\n  }\r\n\r\n  getProfileById(userInRoom: any) {\r\n    let userId = userInRoom.user_id;\r\n    return this.userProfiles?.find((user) => user.userId == userId);\r\n  }\r\n\r\n  @HostListener('window:keydown', ['$event'])\r\n  onKeyDown(this: RoomViewComponent, event: KeyboardEvent) {\r\n    let code = event.code;\r\n    if (this._permittedKeys.includes(code) && !this._keysDown.includes(code))\r\n      this._keysDown.push(code);\r\n  }\r\n\r\n  @HostListener('window:keyup', ['$event'])\r\n  onKeyUp(this: RoomViewComponent, event: KeyboardEvent) {\r\n    let index = _.indexOf(this._keysDown, event.code)\r\n    delete this._keysDown[index];\r\n  }\r\n\r\n  _overlappingUserPixelsAt({ x, y }: Position): any {\r\n    const diameter = this.circleRadius * 2;\r\n\r\n    let users = this.untransformedData?.filter((user) => user.user_id !== this.localUser.id);\r\n\r\n    if (users) {\r\n      function getDistanceFrom(pos: Position): number {\r\n        let coords = {\r\n          x: (pos.x - x) ** 2,\r\n          y: (pos.y - y) ** 2\r\n        };\r\n\r\n        let distance = Math.sqrt(coords.x + coords.y);\r\n\r\n        return distance;\r\n      }\r\n\r\n      let distances: Distances = {};\r\n      for (const user of users) {\r\n        distances[user.user_id] = getDistanceFrom(user.data.position);\r\n      }\r\n\r\n      let isTouchingUsers = {};\r\n      for (const pair of Object.entries(distances)) {\r\n        let userId = Number(pair[0]),\r\n          distance = pair[1];\r\n\r\n        isTouchingUsers[userId] = distance < diameter;\r\n      }\r\n      \r\n      return isTouchingUsers;\r\n    }\r\n  }\r\n\r\n  userTouchedAt({ x, y }: Position) {\r\n    let usersTouched = this._overlappingUserPixelsAt({ x, y });\r\n\r\n    var userIds = Object.keys(usersTouched || {})\r\n      .filter((k) => usersTouched[k])\r\n      .map((userId) => Number(userId))\r\n      [0];\r\n\r\n    return userIds;\r\n  }\r\n\r\n  updateVelocities(this: RoomViewComponent) {\r\n    let newVelocity, newAngularVelocity;\r\n\r\n    if (this._keysDown.includes('ArrowUp')) {\r\n      newVelocity = this.localUser.velocity + 0.046875\r\n\r\n      this.localUser.velocity = newVelocity;\r\n    }\r\n    if (this._keysDown.includes('ArrowLeft')) {\r\n      newAngularVelocity = this.localUser.angularVelocity - 0.0234375;\r\n\r\n      this.localUser.angularVelocity = newAngularVelocity;\r\n    }\r\n    if (this._keysDown.includes('ArrowRight')) {\r\n      newAngularVelocity = this.localUser.angularVelocity + 0.0234375;\r\n\r\n      this.localUser.angularVelocity = newAngularVelocity;\r\n    }\r\n  }\r\n\r\n  moved() {\r\n    return !(_.isEqual(this.localUser.position, this.localUser.hist.prevPosition))\r\n  }\r\n\r\n  updateLocalUser(this: RoomViewComponent) {\r\n    let newPosition = {\r\n      y: this.localUser.position.y + Math.sin((this.localUser.direction - 90) * (Math.PI / 180)) * this.localUser.velocity,\r\n      x: this.localUser.position.x + Math.cos((this.localUser.direction - 90) * (Math.PI / 180)) * this.localUser.velocity\r\n    };\r\n\r\n    this.localUser.hist.prevPosition = Object.assign({}, this.localUser.position);\r\n    this.localUser.hist.prevDirection = this.localUser.direction;\r\n\r\n    let idOfCollidedUser = this.userTouchedAt(newPosition);\r\n    if (idOfCollidedUser) {\r\n      this.localUserOnCollidedUpdate(idOfCollidedUser, newPosition);\r\n    } else {\r\n      this.localUser.position = newPosition;\r\n    }\r\n\r\n    this.localUser.direction += this.localUser.angularVelocity;\r\n  }\r\n\r\n  localUserOnCollidedUpdate(idOfCollidedUser: number, newPosition: Position) {\r\n    let collidedUser = this.untransformedData?.find((user) => user.user_id === idOfCollidedUser).data.position;\r\n\r\n    this.localUser.position = findCollisionPoint(newPosition, collidedUser);\r\n  }\r\n\r\n  updateData(this: RoomViewComponent) {\r\n    let user = this.untransformedData?.find((user) => user.user_id === this.localUser.id);\r\n\r\n    if (user) {\r\n      user.data.position = this.localUser.position;\r\n      user.data.direction = this.localUser.direction;\r\n\r\n      let transformedData = transformData(this.untransformedData, this.localUser.id);\r\n      this.data = transformedData;\r\n    }\r\n  }\r\n\r\n  updateDrags() {\r\n    if (Math.abs(this.localUser.velocity) < 0.025) {\r\n      this.localUser.velocity = 0;\r\n      this.localUser.drag = 0;\r\n    } else this.localUser.drag = this.localUser.velocity / 30;\r\n\r\n    if (Math.abs(this.localUser.angularVelocity) < 0.001) {\r\n      this.localUser.angularVelocity = 0;\r\n      this.localUser.angularDrag = 0;\r\n    } else this.localUser.angularDrag = this.localUser.angularVelocity / 30;\r\n  }\r\n\r\n  // addDrags(this: RoomViewComponent) {\r\n  //   let change = Math.sign(this.localUser.velocity) == -1\r\n  //     ? this.localUser.drag\r\n  //     : -this.localUser.drag;\r\n  //   let angularChange = Math.sign(this.localUser.angularVelocity) == -1\r\n  //     ? this.localUser.angularDrag\r\n  //     : -this.localUser.angularDrag;\r\n\r\n  //   const differentSigns = (newVelocity: number) => Math.sign(newVelocity - change) != Math.sign(newVelocity);\r\n\r\n  //   let newVelocity = this.localUser.velocity + change;\r\n  addDrags(this: RoomViewComponent) {\r\n    this.localUser.velocity -= this.localUser.drag;\r\n    this.localUser.angularVelocity -= this.localUser.angularDrag;\r\n  }\r\n\r\n  sendMessage() {\r\n    let position = this.localUser.position;\r\n    let direction = this.localUser.direction;\r\n\r\n    this.webSocketService.webSocket?.next({\r\n      type: 'move',\r\n      new_position: position,\r\n      user_id: this.localUser.id\r\n    });\r\n  }\r\n\r\n  onMessage(event: any) {\r\n    console.log(event);\r\n  }\r\n\r\n  pushData() {\r\n    this.frames.push({\r\n      position: this.localUser.position,\r\n      direction: this.localUser.direction\r\n    });\r\n  }\r\n  refreshRoomView = () => {\r\n    this.updateVelocities();\r\n    this.updateDrags();\r\n    this.addDrags();\r\n\r\n    if (this.localUser.velocity || this.localUser.angularVelocity)\r\n      this.updateLocalUser();\r\n    this.updateData();\r\n\r\n    this.pushData();\r\n\r\n    if (this.shouldContinueAnimating)\r\n      requestAnimationFrame(this.refreshRoomView);\r\n    else\r\n      cancelAnimationFrame(this.animationId);\r\n  }\r\n\r\n  async ngOnInit(this: RoomViewComponent): Promise<any> {\r\n    this.data = [];\r\n\r\n    await this.webSocketService.init();\r\n    \r\n    // Send an initial message\r\n    let initialPosition = Object.assign({}, this.localUser.position);\r\n\r\n    this.webSocketService.webSocket?.subscribe();\r\n    this.webSocketService.webSocket?.next({\r\n      action: 'join',\r\n      initial_position: initialPosition,\r\n      user_id: this.localUser.id,\r\n      request_id: this.localUser.id\r\n    });\r\n\r\n    // Get initial data\r\n    this.animationId = requestAnimationFrame(this.refreshRoomView.bind(this));\r\n    this.roomDataService.getInitialData()\r\n      .subscribe((res) => {\r\n        let data = res.data;\r\n        this.untransformedData = data;\r\n\r\n        let transformedData = transformData(this.untransformedData, this.localUser.id);\r\n        this.data = transformedData;\r\n\r\n        this.loadProfiles();\r\n      });\r\n    \r\n    this.refreshRoomView();\r\n\r\n    setInterval(() => {\r\n      this.webSocketService.webSocket?.next({\r\n        request_id: this.localUser.id,\r\n        action: 'move',\r\n        frames: this.frames\r\n      });\r\n    }, 250);\r\n\r\n    this.webSocketService.webSocket?.subscribe((msg: any) => this.onMessage(msg));\r\n  }\r\n\r\n}\r\n","<svg\r\n  xmlns=\"http://www.w3.org/2000/svg\"\r\n  height=\"50\"\r\n  preserveAspectRatio=\"xMidYMid\"\r\n  attr.viewBox=\"0 0 {{getDimensions().width}} {{getDimensions().height}}\"\r\n>\r\n  <!-- Experiment in line 5 or so -->\r\n  <defs>\r\n    <ng-container *ngIf=\"userProfiles\">\r\n      <pattern\r\n        id=\"pattern-user-{{userProfile.userId}}\"\r\n        x=\"0\"\r\n        y=\"0\"\r\n        width=\"25\"\r\n        height=\"25\"\r\n        *ngFor=\"let userProfile of userProfiles\"\r\n      >\r\n        <image\r\n          [attr.href]=\"userProfile.profile.avatar\"\r\n          width=\"25\"\r\n          height=\"25\"\r\n        />\r\n      </pattern>\r\n    </ng-container>\r\n  </defs>\r\n  <g attr.transform=\"rotate({{-(localUser.direction || 0)}} {{getCenterLocation().x}} {{getCenterLocation().y}})\" #roomView>\r\n    <circle\r\n      [attr.r]=\"circleRadius\"\r\n      [attr.cx]=\"userInRoom.position.x\"\r\n      [attr.cy]=\"userInRoom.position.y\"\r\n      attr.fill=\"url(#pattern-user-{{getProfileById(userInRoom)?.userId}})\"\r\n      attr.transform=\"rotate({{userInRoom.direction}} {{userInRoom.position.x}} {{userInRoom.position.y}})\"\r\n      class=\"user\"\r\n      id=\"user-{{getProfileById(userInRoom)?.userId}}\"\r\n      *ngFor=\"let userInRoom of data\" />\r\n  </g>\r\n</svg>\r\n","export function transformData(userData: any, userId: number) {\r\n    // Transform based on distance to user of ID userId\r\n\r\n    let user = userData.find((userInRoom: any) => userInRoom.user_id == userId);\r\n\r\n    let distances: any = {};\r\n    for (const data of userData) {\r\n        let positionData = data.data;\r\n        distances[data.user_id] = {\r\n            x: positionData.position.x - user.data.position.x,\r\n            y: positionData.position.y - user.data.position.y\r\n        };\r\n    }\r\n\r\n    let transformation = Object\r\n        .entries(distances)\r\n        .map((entries: any) => {\r\n            let userId = parseInt(entries[0]),\r\n                distanceData = entries[1]\r\n            \r\n            let center = {\r\n                x: window.innerWidth / 2,\r\n                y: window.innerHeight / 2\r\n            };\r\n\r\n            let position = {\r\n                x: center.x + distanceData.x,\r\n                y: center.y + distanceData.y\r\n            };\r\n            return {\r\n                position: position,\r\n                user_id: userId\r\n            };\r\n        })\r\n        // Add the direction data to the transformed data as well\r\n        .map((data: any) => {\r\n            let direction = userData.find((user: any) => user.user_id === data.user_id)\r\n                .data\r\n                .direction;\r\n            return {\r\n                ...data,\r\n                direction: direction\r\n            }\r\n        })\r\n\r\n\r\n    return transformation;\r\n}","import { Injectable } from '@angular/core';\r\nimport { firstValueFrom, observable, Observable } from 'rxjs';\r\nimport { webSocket, WebSocketSubject } from 'rxjs/webSocket';\r\nimport { RoomDataService } from './room-data.service';\r\nimport { RoomViewComponent } from './room-view.component';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WebSocketService {\r\n  webSocket?: WebSocketSubject<any>;\r\n  \r\n  constructor(private roomDataService: RoomDataService) {\r\n  }\r\n\r\n  async init() {\r\n    let url = `ws://localhost:8000/ws/room/`\r\n    this.webSocket = webSocket(url);\r\n  }\r\n\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { HttpService } from './http.service';\r\n\r\nimport { Observable, firstValueFrom } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserDataService {\r\n  constructor(private httpService: HttpService) {}\r\n\r\n  fetchUser(id: number): Observable<any> {\r\n    return this.httpService.httpClient.get(`/api/user/${id}`, { responseType: 'json' });\r\n  }\r\n\r\n  fetchUsers(ids: number[]): Observable<any[]> {\r\n    return new Observable((sub) => {\r\n      let users: any[] = [];\r\n      for (const id of ids) {\r\n        this.fetchUser(id)\r\n          .subscribe((userData: any) => {\r\n            users.push(userData);\r\n          })\r\n      }\r\n\r\n      sub.next(users);\r\n    });\r\n  }\r\n\r\n  private loadUserProfile(id: number): Observable<any> {\r\n    return new Observable((sub) => {\r\n      this.fetchUser(id)\r\n        .subscribe((data: any) => {\r\n          sub.next({\r\n            userId: data.user.id,\r\n            profile: data.user_profile\r\n          })\r\n        });\r\n    })\r\n  }\r\n  loadUserProfiles(ids: number[]): Observable<any[]> {\r\n    return new Observable((sub) => {\r\n      let profiles: any[] = [];\r\n\r\n      let observables = ids.map((id) => this.loadUserProfile(id));\r\n      let promises = observables.map((observable) => firstValueFrom(observable));\r\n      Promise.all(promises)\r\n        .then((profiles) => sub.next(profiles));\r\n    });\r\n  }\r\n}\r\n","import { Injectable, Renderer2, RendererFactory2 } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WindowService {\r\n  constructor() {}\r\n\r\n  getDimensions() {\r\n    return {\r\n      width: window.innerWidth,\r\n      height: window.innerHeight\r\n    };\r\n  }\r\n}\r\n","// This file can be replaced during build by using the `fileReplacements` array.\r\n// `ng build` replaces `environment.ts` with `environment.prod.ts`.\r\n// The list of file replacements can be found in `angular.json`.\r\n\r\nexport const environment = {\r\n  production: false\r\n};\r\n\r\n/*\r\n * For easier debugging in development mode, you can import the following file\r\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\r\n *\r\n * This import should be commented out in production mode because it will have a negative impact\r\n * on performance if an error is thrown.\r\n */\r\n// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.\r\n","import 'zone.js';\r\n\r\nimport { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule)\r\n  .catch(err => console.error(err));\r\n"],"names":["transformData","_","findCollisionPoint","i0","userInRoom_r5","RoomViewComponent","constructor","roomDataService","userDataService","webSocketService","windowService","position","x","y","direction","velocity","angularVelocity","drag","angularDrag","id","hist","prevPosition","prevDirection","updateVelocities","updateDrags","addDrags","localUser","updateLocalUser","updateData","pushData","shouldContinueAnimating","requestAnimationFrame","refreshRoomView","cancelAnimationFrame","animationId","onUnload","getDimensions","getCenterLocation","dimensions","centerX","width","centerY","height","loadProfiles","data","length","ids","_a","map","user","user_id","loadUserProfiles","subscribe","profiles","userProfiles","getProfileById","userInRoom","userId","find","onKeyDown","event","code","_permittedKeys","includes","_keysDown","push","onKeyUp","index","indexOf","_overlappingUserPixelsAt","diameter","circleRadius","users","untransformedData","filter","getDistanceFrom","pos","coords","distance","Math","sqrt","distances","isTouchingUsers","pair","Object","entries","Number","userTouchedAt","usersTouched","userIds","keys","k","newVelocity","newAngularVelocity","moved","isEqual","newPosition","sin","PI","cos","assign","idOfCollidedUser","localUserOnCollidedUpdate","collidedUser","transformedData","abs","sendMessage","webSocket","next","type","new_position","onMessage","console","log","frames","ngOnInit","init","initialPosition","_b","action","initial_position","request_id","bind","getInitialData","res","setInterval","_c","msg","selectors","viewQuery","ctx","WebSocketService","url","factory","providedIn"],"sourceRoot":"webpack:///"}